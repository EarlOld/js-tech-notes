<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Array vs Float32Array vs GPU Benchmark</title>
    <script src="https://unpkg.com/gpu.js@latest/dist/gpu-browser.min.js"></script>
    <style>
      body {
        font-family: sans-serif;
        padding: 2rem;
      }
      button {
        margin: 0.5rem;
        padding: 0.6rem 1.2rem;
        font-size: 1rem;
      }
      pre {
        background: #111;
        color: #0f0;
        padding: 1rem;
        margin-top: 1rem;
        white-space: pre-wrap;
      }
    </style>
  </head>
  <body>
    <h1>üî¨ Benchmark: Array vs Float32Array vs GPU.js</h1>
    <button onclick="testArray()">‚ñ∂Ô∏è Benchmark Array</button>
    <button onclick="testTypedArray()">‚ñ∂Ô∏è Benchmark Float32Array</button>
    <button onclick="testGPU()">
      ‚ñ∂Ô∏è Benchmark GPU.js Matrix Multiply (512x512)
    </button>

    <pre id="output">Waiting for input...</pre>

    <script>
      const output = document.getElementById("output");

      function log(msg) {
        output.textContent += `\n${msg}`;
      }

      function testArray() {
        const a = new Array(1024).fill(Math.random() * 100);
        const t0 = performance.now();

        let sum = 0;
        for (let i = 0; i < a.length; i++) sum += a[i] * 2;
        const t1 = performance.now();
        log(`Array sum done in ${(t1 - t0).toFixed(2)} ms`);
      }

      function testTypedArray() {
        const t = new Float32Array(1024).fill(Math.random() * 100);
        const t0 = performance.now();
        let sum = 0;
        for (let i = 0; i < t.length; i++) sum += t[i] * 2;
        const t1 = performance.now();
        log(`Float32Array sum done in ${(t1 - t0).toFixed(2)} ms`);
      }

      function testGPU() {
        const size = 1024;
        const A = Array.from({ length: size }, () => Array(size).fill(Math.random() * 100));
        const B = Array.from({ length: size }, () => Array(size).fill(Math.random() * 100));

        const gpu = new GPU.GPU();
        const multiplyMatrix = gpu
          .createKernel(function (a, b, n) {
            let sum = 0;
            for (let i = 0; i < n; i++) {
              sum += a[this.thread.y][i] * b[i][this.thread.x];
            }
            return sum;
          })
          .setOutput([size, size]);

        const t0 = performance.now();
        multiplyMatrix(A, B, size);
        const t1 = performance.now();

        log(
          `GPU.js Matrix Multiply 512x512 done in ${(t1 - t0).toFixed(2)} ms`
        );
      }
    </script>
  </body>
</html>
